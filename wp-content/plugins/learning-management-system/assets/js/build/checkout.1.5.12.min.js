jQuery((function(e){if("undefined"==typeof _MASTERIYO_CHECKOUT_)return!1;var t={$form:e("form.masteriyo-checkout"),getAjaxURL:function(){return _MASTERIYO_CHECKOUT_.ajaxURL},getCheckoutURL:function(){return _MASTERIYO_CHECKOUT_.checkoutURL},init:function(){e(document.body).on("update_checkout",this.updateCheckout),e(document.body).on("init_checkout",this.initCheckout),this.$form.on("click",'input[name="payment_method"]',this.paymentMethodSelected),this.$form.attr("novalidate","novalidate"),this.$form.on("submit",this.submit),this.initPaymentMethods(),!0===_MASTERIYO_CHECKOUT_.is_checkout&&e(document.body).trigger("initCheckout")},initPaymentMethods:function(){var o=this.$form.find('input[name="payment_method"]');1===o.length&&o.eq(0).hide(),t.selectedPaymentMethod&&e("#"+t.selectedPaymentMethod).prop("checked",!0),0===o.filter(":checked").length&&o.eq(0).prop("checked",!0);var i=o.filter(":checked").eq(0).prop("id");o.length>1&&e('div.payment-box:not(".'+i+'")').filter(":visible").slideUp(0),o.filter(":checked").eq(0).trigger("click")},getPaymentMethod:function(){return this.$form.find('input[name="payment_method"]:checked').val()},paymentMethodSelected:function(t){if(t.stopPropagation(),e(".payment-methods input.input-radio").length>1){var o=e("div.payment-box."+e(this).attr("ID")),i=e(this).is(":checked");i&&!o.is(":visible")&&(e("div.payment-box").filter(":visible").slideUp(230),i&&o.slideDown(230))}else e("div.payment-box").show();e(this).data("order_button_text")?e("#masteriyo-place-order").text(e(this).data("order_button_text")):e("#masteriyo-place-order").text(e("#masteriyo-place-order").data("value"));var r=e('.masteriyo-checkout input[name="payment_method"]:checked').attr("id");r!==this.selectedPaymentMethod&&e(document.body).trigger("paymentMethodSelected"),this.selectedPaymentMethod=r},initCheckout:function(){e(document.body).trigger("update_checkout")},resetUpdateCheckoutTimer:function(){clearTimeout(t.updateTimer)},isValidJson:function(e){try{var t=JSON.parse(e);return t&&"object"==typeof t}catch(e){return!1}},updateCheckout:function(e,o){t.resetUpdateCheckoutTimer(),t.updateTimer=setTimeout(t.updateCheckoutAction,"5",o)},handleUnloadEvent:function(e){if(-1===navigator.userAgent.indexOf("MSIE")&&!document.documentMode)return!0;e.preventDefault()},attachUnloadEventsOnSubmit:function(){e(window).on("beforeunload",this.handleUnloadEvent)},detachUnloadEventsOnSubmit:function(){e(window).off("beforeunload",this.handleUnloadEvent)},submitError:function(o){e(".masteriyo-NoticeGroup-checkout, .masteriyo-error, .masteriyo-message").remove(),t.$form.prepend('<div class="masteriyo-NoticeGroup masteriyo-NoticeGroup-checkout">'+o+"</div>"),t.$form.find(".input-text, select, input:checkbox").trigger("validate").trigger("blur"),t.scrollToNotices(),e(document.body).trigger("checkout_error",[o])},scrollToNotices:function(){var t=e(".masteriyo-NoticeGroup-updateOrderReview, .masteriyo-NoticeGroup-checkout");t.length||(t=e("form.masteriyo-checkout")),t.length&&e("html, body").animate({scrollTop:t.offset().top-100},1e3)},handleFormSubmissionFailure:function(e,o,i){t.detachUnloadEventsOnSubmit();try{error=e.responseJSON,t.submitError('<div class="masteriyo-error">'+error.data.messages+"</div>")}catch(e){console.log(e)}},handleFormSubmissionSuccess:function(o,i,r){t.detachUnloadEventsOnSubmit();try{if("success"!==o.result||!1===t.$form.triggerHandler("checkout_place_order_success",o))throw"failure"===o.result?"Result failure":"Invalid response";-1===o.redirect.indexOf("https://")||-1===o.redirect.indexOf("http://")?window.location=o.redirect:window.location=decodeURI(o.redirect)}catch(i){if(!0===o.reload)return void window.location.reload();!0===o.refresh&&e(document.body).trigger("update_checkout"),o.messages&&t.submitError(o.messages)}},submit:function(o){return console.log("Checkout form submission"),t.$form.is(".processing")||!1!==t.$form.triggerHandler("checkout_place_order")&&!1!==t.$form.triggerHandler("checkout_place_order_"+t.getPaymentMethod())&&(t.attachUnloadEventsOnSubmit(),e.ajax({type:"POST",url:t.getCheckoutURL(),dataType:"json",data:t.$form.serialize(),beforeSend:function(e){t.$form.addClass("processing").block({message:'<span class="spinner" style="visibility:visible"></span>',css:{border:"",width:"0%"},overlayCSS:{background:"#fff",opacity:.6}})},success:function(e,o,i){t.handleFormSubmissionSuccess(e,o,i)},error:function(e,o,i){t.handleFormSubmissionFailure(e,o,i)},complete:function(e,o){t.detachUnloadEventsOnSubmit(),t.$form.removeClass("processing").unblock()}})),!1}};t.init()}));